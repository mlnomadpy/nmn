<!DOCTYPE html>
<html>
<head>
    <title>Yat vs Dot XOR Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .neuron-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        svg {
            background: #f8f9fa;
            border-radius: 4px;
        }
        .point {
            stroke: black;
            stroke-width: 1px;
        }
        .title {
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .loss-display {
            margin-top: 10px;
            font-family: monospace;
        }
        .history-plots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .history-plot {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 5px;
        }
        .line {
            fill: none;
            stroke-width: 2;
        }
        .history-title {
            font-size: 0.9em;
            text-align: center;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Yat vs Dot Neural Network - XOR Demo</h1>
        <div class="grid">
            <div class="neuron-card">
                <div class="title">Traditional Dot Product Neuron</div>
                <div id="dot-plot"></div>
                <div class="controls">
                    <button onclick="optimizeDot()">Optimize</button>
                    <button onclick="resetDot()">Reset</button>
                </div>
                <div id="dot-loss" class="loss-display">Loss: 0.25</div>
                <div class="history-plots">
                    <div class="history-plot">
                        <div class="history-title">Loss History</div>
                        <div id="dot-loss-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Accuracy History</div>
                        <div id="dot-accuracy-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Magnitude History</div>
                        <div id="dot-magnitude-history"></div>
                    </div>
                </div>
            </div>
            <div class="neuron-card">
                <div class="title">ⵟ-Neuron</div>
                <div id="yat-plot"></div>
                <div class="controls">
                    <button onclick="optimizeYat()">Optimize</button>
                    <button onclick="resetYat()">Reset</button>
                </div>
                <div id="yat-loss" class="loss-display">Loss: 0.25</div>
                <div class="history-plots">
                    <div class="history-plot">
                        <div class="history-title">Loss History</div>
                        <div id="yat-loss-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Accuracy History</div>
                        <div id="yat-accuracy-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Magnitude History</div>
                        <div id="yat-magnitude-history"></div>
                    </div>
                </div>
            </div>
            <div class="neuron-card">
                <div class="title">Posi-ⵟ Neuron (will be useful in the future lol)</div>
                <div id="posi-plot"></div>
                <div class="controls">
                    <button onclick="optimizePosi()">Optimize</button>
                    <button onclick="resetPosi()">Reset</button>
                </div>
                <div id="posi-loss" class="loss-display">Loss: 0.25</div>
                <div class="history-plots">
                    <div class="history-plot">
                        <div class="history-title">Loss History</div>
                        <div id="posi-loss-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Accuracy History</div>
                        <div id="posi-accuracy-history"></div>
                    </div>
                    <div class="history-plot">
                        <div class="history-title">Magnitude History</div>
                        <div id="posi-magnitude-history"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// Set up constants and data
const width = 350;
const height = 350;
const margin = { top: 20, right: 20, bottom: 30, left: 30 };
const innerWidth = width - margin.left - margin.right;
const innerHeight = height - margin.top - margin.bottom;

// XOR dataset
const data = [
    { x: 0, y: 0, label: 0 },
    { x: 0, y: 1, label: 1 },
    { x: 1, y: 0, label: 1 },
    { x: 1, y: 1, label: 0 }
];

// Neuron functions
function dotNeuron(x, y, w1, w2, b) {
    return w1 * x + w2 * y + b;
}

function yatNeuron(x, y, w1, w2, b) {
    const dot = w1 * x + w2 * y;
    const dist = Math.pow(w1 - x, 2) + Math.pow(w2 - y, 2);
    const epsilon = 1e-6;
    return (dot * dot) / (dist + epsilon) + b;
}

function posiYatNeuron(x, y, w1, w2, b) {
    const dot = w1 * x + w2 * y;
    const dist = Math.pow(w1 - x, 2) + Math.pow(w2 - y, 2);
    const epsilon = 1e-6;
    return Math.sqrt(dist) / (dot * dot + epsilon) + b;
}

// Initialize weights and biases
let dotParams = { w1: Math.random() - 0.5, w2: Math.random() - 0.5, b: Math.random() - 0.5 };
let yatParams = { w1: Math.random() - 0.5, w2: Math.random() - 0.5, b: Math.random() - 0.5 };
let posiParams = { w1: Math.random() - 0.5, w2: Math.random() - 0.5, b: Math.random() - 0.5 };

// Create scales
const xScale = d3.scaleLinear()
    .domain([-0.5, 1.5])
    .range([0, innerWidth]);

const yScale = d3.scaleLinear()
    .domain([-0.5, 1.5])
    .range([innerHeight, 0]);

// Create SVG containers
function createPlot(containerId) {
    const svg = d3.select(`#${containerId}`)
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    const g = svg.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

    // Add axes
    g.append('g')
        .attr('transform', `translate(0,${innerHeight})`)
        .call(d3.axisBottom(xScale));

    g.append('g')
        .call(d3.axisLeft(yScale));

    // Add grid
    const gridSize = 30;
    const gridData = [];
    for (let x = 0; x <= gridSize; x++) {
        for (let y = 0; y <= gridSize; y++) {
            gridData.push({
                x: -0.5 + (2 * x / gridSize),
                y: -0.5 + (2 * y / gridSize)
            });
        }
    }

    // Add grid points
    g.selectAll('.grid-point')
        .data(gridData)
        .enter()
        .append('circle')
        .attr('class', 'grid-point')
        .attr('cx', d => xScale(d.x))
        .attr('cy', d => yScale(d.y))
        .attr('r', 2)
        .attr('fill', '#ddd');

    // Add XOR points
    g.selectAll('.point')
        .data(data)
        .enter()
        .append('circle')
        .attr('class', 'point')
        .attr('cx', d => xScale(d.x))
        .attr('cy', d => yScale(d.y))
        .attr('r', 6)
        .attr('fill', d => d.label === 1 ? '#ff4444' : '#4444ff');

    return g;
}

// Create history plot
function createHistoryPlot(containerId, height = 100) {
    const width = (innerWidth - 20) / 3;
    
    const svg = d3.select(`#${containerId}`)
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    const g = svg.append('g')
        .attr('transform', 'translate(5,5)');

    // Add axes (will be updated later)
    g.append('g')
        .attr('class', 'x-axis')
        .attr('transform', `translate(0,${height - 20})`);

    g.append('g')
        .attr('class', 'y-axis')
        .attr('transform', 'translate(25,0)');

    // Add path for the line
    g.append('path')
        .attr('class', 'line')
        .attr('stroke', '#007bff');

    return g;
}

// Create all plots
const dotPlot = createPlot('dot-plot');
const yatPlot = createPlot('yat-plot');
const posiPlot = createPlot('posi-plot');

// Create history plots
const historyPlots = {
    dot: {
        loss: createHistoryPlot('dot-loss-history'),
        accuracy: createHistoryPlot('dot-accuracy-history'),
        magnitude: createHistoryPlot('dot-magnitude-history')
    },
    yat: {
        loss: createHistoryPlot('yat-loss-history'),
        accuracy: createHistoryPlot('yat-accuracy-history'),
        magnitude: createHistoryPlot('yat-magnitude-history')
    },
    posi: {
        loss: createHistoryPlot('posi-loss-history'),
        accuracy: createHistoryPlot('posi-accuracy-history'),
        magnitude: createHistoryPlot('posi-magnitude-history')
    }
};

// Update functions
function updatePlot(g, neuronFn, params) {
    const gridSize = 30;
    const points = [];
    
    for (let x = 0; x <= gridSize; x++) {
        for (let y = 0; y <= gridSize; y++) {
            const xVal = -0.5 + (2 * x / gridSize);
            const yVal = -0.5 + (2 * y / gridSize);
            const output = neuronFn(xVal, yVal, params.w1, params.w2, params.b);
            points.push({
                x: xVal,
                y: yVal,
                value: output
            });
        }
    }

    g.selectAll('.grid-point')
        .data(points)
        .attr('fill', d => d.value > 0.5 ? 'rgba(255,100,100,0.2)' : 'rgba(100,100,255,0.2)');
}

// Loss calculation
function calculateLoss(neuronFn, params) {
    return data.reduce((sum, point) => {
        const output = neuronFn(point.x, point.y, params.w1, params.w2, params.b);
        return sum + Math.pow(output - point.label, 2);
    }, 0) / data.length;
}

// Gradient descent
function gradientDescent(neuronFn, params, learningRate = 0.01) {
    const epsilon = 1e-7;
    const gradients = { w1: 0, w2: 0, b: 0 };
    
    // Calculate gradients numerically
    for (let param in params) {
        const originalValue = params[param];
        params[param] = originalValue + epsilon;
        const lossPlus = calculateLoss(neuronFn, params);
        params[param] = originalValue - epsilon;
        const lossMinus = calculateLoss(neuronFn, params);
        gradients[param] = (lossPlus - lossMinus) / (2 * epsilon);
        params[param] = originalValue;
    }

    // Update parameters
    for (let param in params) {
        params[param] -= learningRate * gradients[param];
    }

    return calculateLoss(neuronFn, params);
}

// Calculate accuracy
function calculateAccuracy(neuronFn, params) {
    return data.reduce((correct, point) => {
        const output = neuronFn(point.x, point.y, params.w1, params.w2, params.b);
        return correct + ((output > 0.5 ? 1 : 0) === point.label ? 1 : 0);
    }, 0) / data.length;
}

// Calculate neuron magnitude
function calculateMagnitude(params) {
    return Math.sqrt(params.w1 * params.w1 + params.w2 * params.w2);
}

// Update history plots
function updateHistoryPlots(plots, history) {
    const updatePlot = (plot, data, color) => {
        const width = (innerWidth - 20) / 3;
        const height = 100;
        
        const xScale = d3.scaleLinear()
            .domain([0, data.length - 1])
            .range([30, width - 5]);

        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data) * 1.1])
            .range([height - 20, 5]);

        const line = d3.line()
            .x((d, i) => xScale(i))
            .y(d => yScale(d));

        plot.select('.line')
            .datum(data)
            .attr('d', line)
            .attr('stroke', color);

        // Update axes
        const xAxis = d3.axisBottom(xScale)
            .ticks(5)
            .tickSize(5);
        
        const yAxis = d3.axisLeft(yScale)
            .ticks(5)
            .tickSize(5);

        plot.select('.x-axis').call(xAxis);
        plot.select('.y-axis').call(yAxis);
    };

    updatePlot(plots.loss, history.loss, '#ff4444');
    updatePlot(plots.accuracy, history.accuracy, '#44ff44');
    updatePlot(plots.magnitude, history.magnitude, '#4444ff');
}

// Optimization functions
function optimize(neuronFn, params, plot, lossDisplay, historyPlots, iterations = 100) {
    const history = {
        loss: [],
        accuracy: [],
        magnitude: []
    };
    let i = 0;
    const interval = setInterval(() => {
        const loss = gradientDescent(neuronFn, params, 0.1);
        const accuracy = calculateAccuracy(neuronFn, params);
        const magnitude = calculateMagnitude(params);
        
        history.loss.push(loss);
        history.accuracy.push(accuracy);
        history.magnitude.push(magnitude);
        
        updatePlot(plot, neuronFn, params);
        updateHistoryPlots(historyPlots, history);
        lossDisplay.textContent = `Loss: ${loss.toFixed(4)} | Accuracy: ${(accuracy * 100).toFixed(1)}%`;
        
        i++;
        if (i >= iterations) {
            clearInterval(interval);
        }
    }, 50);
}

// Reset functions
function resetParams(params) {
    params.w1 = Math.random() - 0.5;
    params.w2 = Math.random() - 0.5;
    params.b = Math.random() - 0.5;
}

// Event handlers
function optimizeDot() {
    optimize(dotNeuron, dotParams, dotPlot, document.getElementById('dot-loss'), historyPlots.dot);
}

function optimizeYat() {
    optimize(yatNeuron, yatParams, yatPlot, document.getElementById('yat-loss'), historyPlots.yat);
}

function optimizePosi() {
    optimize(posiYatNeuron, posiParams, posiPlot, document.getElementById('posi-loss'), historyPlots.posi);
}

function resetDot() {
    resetParams(dotParams);
    updatePlot(dotPlot, dotNeuron, dotParams);
    document.getElementById('dot-loss').textContent = `Loss: ${calculateLoss(dotNeuron, dotParams).toFixed(4)}`;
}

function resetYat() {
    resetParams(yatParams);
    updatePlot(yatPlot, yatNeuron, yatParams);
    document.getElementById('yat-loss').textContent = `Loss: ${calculateLoss(yatNeuron, yatParams).toFixed(4)}`;
}

function resetPosi() {
    resetParams(posiParams);
    updatePlot(posiPlot, posiYatNeuron, posiParams);
    document.getElementById('posi-loss').textContent = `Loss: ${calculateLoss(posiYatNeuron, posiParams).toFixed(4)}`;
}

// Initial updates
updatePlot(dotPlot, dotNeuron, dotParams);
updatePlot(yatPlot, yatNeuron, yatParams);
updatePlot(posiPlot, posiYatNeuron, posiParams);
</script>
</body>
</html>